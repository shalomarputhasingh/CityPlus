{% extends 'base.html' %}
{% load static %}

{% block title %}My Issues - CityPulse{% endblock %}

{% block extra_css %}
<style>
    /* Styling inspired by the original but with added status badges */
    * { margin:0; padding:0; box-sizing:border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    
    .top-bar { background:#4b3dbb; color:#fff; padding:16px 30px; display:flex; justify-content:space-between; align-items:center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .top-left { display:flex; align-items:center; gap:15px; }
    .top-left img { width:45px; height:45px; background:#fff; border-radius:50%; padding:5px; object-fit: contain; }
    .top-left h2 { font-size:24px; font-weight: 600; }
    .top-left p { font-size:13px; opacity:0.9; }
    .top-right { font-size:16px; font-weight: 500; }

    .main { padding:30px; background:#f4f6f9; min-height: 85vh; }

    /* Summary Cards */
    .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .card { background: #fff; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); text-align: center; border-bottom: 4px solid transparent; }
    .card h3 { font-size: 32px; color: #333; margin-bottom: 5px; }
    .card p { color: #777; font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }

    .card.total { border-color: #4b3dbb; }
    .card.unverified { border-color: #f1c40f; }
    .card.verified { border-color: #3498db; }
    .card.rejected { border-color: #e74c3c; }
    .card.solved { border-color: #2ecc71; }

    /* Controls */
    .controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
    .page-title { font-size: 24px; color: #333; font-weight: 700; border-left: 5px solid #4b3dbb; padding-left: 15px; }
    
    .btn-new { background:#4b3dbb; color:#fff; padding: 12px 25px; border-radius: 30px; text-decoration: none; font-weight: 600; box-shadow: 0 4px 10px rgba(75, 61, 187, 0.3); transition: all 0.3s ease; }
    .btn-new:hover { background: #3a2fa8; transform: translateY(-2px); }

    /* Table */
    .table-container { background:#fff; border-radius:15px; padding:0; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    table { width:100%; border-collapse:collapse; }
    th { background:#f8f9fa; color:#555; padding:15px 20px; text-align:left; font-size:13px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; border-bottom: 2px solid #eee; }
    td { padding:20px; border-bottom: 1px solid #eee; color: #444; vertical-align: middle; }
    tr:last-child td { border-bottom: none; }
    tr:hover { background-color: #fafafa; }

    /* Status Badges */
    .status-badge { padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; display: inline-block; }
    .status-unverified { background: #fff3cd; color: #856404; }
    .status-verified { background: #d1ecf1; color: #0c5460; }
    .status-rejected { background: #f8d7da; color: #721c24; }
    .status-solved { background: #d4edda; color: #155724; }

    .issue-title-link { color: #4b3dbb; text-decoration: none; font-weight: 600; font-size: 16px; }
    .issue-title-link:hover { text-decoration: underline; }
    
    .empty-state { padding: 40px; text-align: center; color: #888; }

    .footer { background:#333; color:#fff; text-align:center; padding:20px; font-size:14px; margin-top: auto; }
</style>
{% endblock %}

{% block content %}
<!-- ================= TOP BAR ================= -->
<div class="top-bar">
  <div class="top-left">
    <img src="{% static 'assets/icons/logo.jpeg' %}" alt="logo">
    <div>
      <h2>CityPulse</h2>
      <p>District Public Grievance System</p>
    </div>
  </div>
  <div class="top-right">
      Welcome, {{ request.user.first_name|default:request.user.username }} | <a href="{% url 'logout' %}" style="color: #fff; text-decoration: underline; margin-left:10px;">Logout</a>
  </div>
</div>

<!-- ================= MAIN ================= -->
<div class="main">

    <!-- Summary Statistics -->
    <div class="summary-cards">
        <div class="card total">
            <h3>{{ stats.total }}</h3>
            <p>Total Issues</p>
        </div>
        <div class="card unverified">
            <h3>{{ stats.unverified }}</h3>
            <p>Pending Review</p>
        </div>
        <div class="card verified">
            <h3>{{ stats.verified }}</h3>
            <p>In Progress</p>
        </div>
        <div class="card solved">
            <h3>{{ stats.solved }}</h3>
            <p>Resolved</p>
        </div>
    </div>

    <div class="controls">
        <h1 class="page-title">My Reported Issues</h1>
        <a href="{% url 'submit_issue' %}" class="btn-new">+ Report New Issue</a>
    </div>

    <!-- ISSUES TABLE -->
    <div class="table-container">
      <table>
        <thead>
            <tr>
              <th>Issue Title</th>
              <th>Category</th>
              <th>Location</th>
              <th>Status</th>
              <th>Date Submitted</th>
              <th>Details</th>
            </tr>
        </thead>
        <tbody>
            {% for issue in issues %}
            <tr>
                <td>
                    <a href="{% url 'issue_detail' issue.id %}" class="issue-title-link">{{ issue.title }}</a>
                </td>
                <td>{{ issue.category }}</td>
                <td>{{ issue.village|default:issue.address }}</td>
                <td>
                    {% if issue.status == 'unverified' %}
                        <span class="status-badge status-unverified">Pending Review</span>
                    {% elif issue.status == 'verified' %}
                        <span class="status-badge status-verified">In Progress</span>
                    {% elif issue.status == 'rejected' %}
                        <span class="status-badge status-rejected">Rejected</span>
                    {% elif issue.status == 'solved' %}
                        <span class="status-badge status-solved">Resolved</span>
                    {% else %}
                        <span class="status-badge">{{ issue.status }}</span>
                    {% endif %}
                </td>
                <td>{{ issue.created_at|date:"M d, Y" }}</td>
                <td><a href="{% url 'issue_detail' issue.id %}" style="color: #666; font-size: 14px;">View &rarr;</a></td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="empty-state">
                    You haven't reported any issues yet. <br><br>
                    <a href="{% url 'submit_issue' %}" style="color: #4b3dbb; font-weight: bold;">Report your first issue</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
      </table>
    </div>

</div>

<div class="footer">
  &copy; 2025 CityPulse â€“ Theni District | Public Grievance System
</div>

<!-- Scripts for Alerts -->
{% if messages %}
<script>
    window.addEventListener('load', function() {
        setTimeout(function() {
            {% for message in messages %}
                // Simple alert for now as requested by user logic in previous dashboard
                alert("{{ message|escapejs }}");
            {% endfor %}
        }, 100);
    });
</script>
{% endif %}

{% endblock %}
